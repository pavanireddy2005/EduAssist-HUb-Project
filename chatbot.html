<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Chatbot | EduAssist Hub</title>
    <link rel="shortcut icon" href="logo.jpeg" />
    <link rel="stylesheet" href="chatbot.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
  </head>
  <body>
    <div class="dashboard">
      <!-- SIDEBAR (reuse existing sidebar styles) -->
      <aside class="sidebar">
        <div class="user-profile">
          <a href="profile.html">
            <img src="userlogo.avif" alt="User" />
          </a>
          <p class="username">Student</p>
        </div>

        <div class="brand">
          <h2>EduAssist</h2>
        </div>

        <nav class="menu">
          <a href="dashboard.html"><i class="fas fa-house"></i> Home</a>
          <a href="#" onclick="openAcademics()"
            ><i class="fas fa-book"></i> Academics</a
          >
          <a href="achievements.html"
            ><i class="fas fa-trophy"></i> Achievements</a
          >
          <a href="support.html"><i class="fas fa-headset"></i> Support</a>
          <a href="chatbot.html" class="active"
            ><i class="fas fa-robot"></i> Chatbot</a
          >
        </nav>

        <div class="logout">
          <a href="login.html">Logout</a>
        </div>
      </aside>

      <!-- MAIN CHAT AREA -->
      <main class="main">
        <!-- HEADER -->
        <div class="chat-header">
          <h1>EduAssist AI ü§ñ</h1>
          <p>Your personal academic & career assistant</p>
        </div>
        <!-- INPUT AREA -->
        <div class="chat-window" id="chatWindow"></div>

        <div class="chat-input">
          <input
            type="text"
            id="userInput"
            placeholder="Type your message..."
          />
          <button onclick="sendMessage()">Send</button>
        </div>
      </main>
    </div>
    <script>
      const API_KEY = "AIzaSyBx_sdxk5K3NomSxVxSn1e7SZZa3PMpS0g";

      const chatWindow = document.getElementById("chatWindow");
      const userInput = document.getElementById("userInput");

      // Initial bot message
      appendBotMessage("Hello üëã I'm EduAssist AI. How can I help you today?");

      function appendUserMessage(message) {
        const div = document.createElement("div");
        div.className = "chat user";
        div.innerHTML = `<p>${message}</p>`;
        chatWindow.appendChild(div);
        chatWindow.scrollTop = chatWindow.scrollHeight;
      }

      function appendBotMessage(message) {
        const div = document.createElement("div");
        div.className = "chat bot";
        div.innerHTML = `<p>${message}</p>`;
        chatWindow.appendChild(div);
        chatWindow.scrollTop = chatWindow.scrollHeight;
      }

      async function sendMessage() {
        const message = userInput.value.trim();
        if (!message) return;

        appendUserMessage(message);
        userInput.value = "";

        appendBotMessage("Typing...");

        try {
          const response = await fetch(
            `https://generativelanguage.googleapis.com/v1/models/gemini-pro:generateContent?key=${API_KEY}`,
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                contents: [
                  {
                    parts: [{ text: message }],
                  },
                ],
              }),
            }
          );

          const data = await response.json();

          // Remove "Typing..."
          chatWindow.removeChild(chatWindow.lastChild);

          const reply =
            data.candidates?.[0]?.content?.parts?.[0]?.text ||
            "Sorry, I couldn't understand that.";

          appendBotMessage(reply);
        } catch (error) {
          chatWindow.removeChild(chatWindow.lastChild);
          appendBotMessage("‚ö†Ô∏è Error connecting to AI. Please try again.");
          console.error(error);
        }
      }
    </script>
    <script>
      function openAcademics() {
        const profile = localStorage.getItem("userProfile");
        console.log("Opening academics for:", profile);

        if (profile === "UG") {
          window.location.href = "ug.html";
        } else if (profile === "PG") {
          window.location.href = "pg.html";
        } else if (profile === "JOB") {
          window.location.href = "job.html";
        } else {
          alert("Please select a profile first");
        }
      }
    </script>
  </body>
</html>
